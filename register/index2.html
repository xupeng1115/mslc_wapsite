<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
		<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
		<meta content="telephone=no" name="format-detection"/>
		<meta content="email=no" name="format-detection"/>
		<meta content="马上理财" name="description"/>
		<title>注册</title>
		<link rel="stylesheet" href="css/common.css" type="text/css"/>
		<style>

			body {
				background-color: transparent;
			}
			.content {
				padding: 3rem 0 0 1rem;
				background-color: transparent;
			}
			.left-logo{
				height: 40px;
				width: 40px;
			}
			.top {
				padding:0.3rem;
			}
			.register-top {
				padding: 1rem 0 0.2rem;
			}
			.form-group{
				padding: 1rem 0 2.5rem;
			}
			.register-btn {
				margin: 3rem 1.5rem 2rem 0;
			}
			.invite {
				padding: 1rem 0 1rem;
			}
			.font-bottom {
				padding-top:0;
			}

			.bank-one {
				width:1.6rem;
			}
			.bank-two {
				width: 3rem;
			}

			.suc-btn a{
				color:#fff;
			}

			.register-suc{
				margin:2rem 1rem 0 0;
			}
			.register-suc-bg{
				background:url('img/register_suc_bg.png') no-repeat;
				background-size:cover;
			}
			.register-suc-bg1{
				background:url('img/register_suc_bg1.png') no-repeat;
				background-size:contain;
				min-width: 10rem;
								min-height: 26rem;
								background-position: center;
								padding-top:3rem;

			}

			.register-suc-btn {
					margin: 1rem 0 1rem 0;
				}

				.suc-pic1{
					margin:0 auto;
					padding:2.5rem 0 .5rem 0;
				}
				.suc-txt{
					padding:0;
					font-size:16px;
					font-weight:bold;
					color:#3c3c3c;
				}
				.suc-txt1{
					font-size:14px;
					color:#969696;
				}

				.suc-txt2{
					font-size:20px;
					color:#42a9ff;
					padding:.5rem 0;
					font-weight:bold;
				}
				.suc-txt3{
					font-size:14px;
					color:#ff6060;
					font-weight:bold;
				}
				.suc-jt img{
					height:30px;
				}

			@media (max-width: 320px) {
				.content {
					padding: 3rem 0 0 0.5rem;
				}

				.register-top {
					padding: 1rem 0 0.2rem;
					font-size: 1.2rem;
				}
				.form-group{
					padding: 0.5rem 0 2.3rem;
					font-size:16px;
				}
				.form-group input{
					padding:0;
					font-size:12px;
				}
				.register-btn {
					margin: 1.8rem 1rem 0.8rem 0;
				}
				.invite {
					padding: 0.6rem 0 0.6rem;
				}

				.xing {
					margin-right: 0.3rem;
					font-size: 0.8rem;
					padding-top: 10px;
				}
				#invite-number {
					font-size:12px;
				}
				.invite-font {
					font-size:12px;
				}
				.bottom-one{
					font-size:12px;
				}
				.agreement{
					font-size:12px;
				}

				.register-suc {
					margin:1rem .2rem 0 0;
				
				}
				.suc-font-one {
					font-size: 1.3rem;
					color: #666;
					padding-top: 3.0rem;
				}
				.suc-font-two {
					font-size: 1rem;
				}
			
				.suc-pic {
					top: auto;
				}
				.register-suc-btn {
					margin-top:.6rem;
				}
				.register-suc-bg1{
					min-width: 8rem;
					min-height: 23rem;
				}

				.suc-pic1{
					
					padding:1.5rem 0 .2rem 0;
				}
				.suc-txt{
				padding:0;
					font-size:14px;
				}
				.suc-txt1{
					font-size:12px;
				}

				.suc-txt2{
					font-size:20px;
					padding:.5rem 0;
				}
				.suc-txt3{
					font-size:12px;
				}
				.suc-jt img{
					height:20px;
				}
			}

		</style>
	</head>
	<body>
		<div class="top">
			<div class="top-left">
				<div class="left-logo">
					<img src="img/logo-mashanglc.png" alt="" />
				</div>
				<div class="left-font">
					<p class="font-top">马上理财</p>
					<p class="font-bottom">拉近你与银行的距离</p>
				</div>
				<div style="clear:both"></div>
			</div>
			<div class="top-right">
				<div class="bank-one">
					<img src="img/bank1.png" alt="" />
				</div>
				<div class="bank-two">
					<img src="img/bank2.png" alt="" />
				</div>
				<div class="bank-three">平安银行</div>
			</div>
		</div>

		<div class="content">
			<div class="register">
				<p class="register-top">注册账户</p>
				<div class="phone form-group">
					<div class="xing">*</div>
					<div class="phone-number">
						<input type="tel" placeholder="手机号码（限大陆地区）" id="user-number"/>
					</div>
				</div>

				<div class="yanzheng form-group">
					<div class="xing">*</div>
					<div class="yanzheng-number">
						<input type="tel" placeholder="验证码" id="user-yanzheng"/>
					</div>
					<div class="yanzheng-get">获取验证码</div>
				</div>

				<div class="invite form-group">
					<input type="text" id="invite-number" placeholder="邀请码(可选)"/>
					<span class="invite-font">  </span>
				</div>

				<div class="password form-group">
					<div class="xing">*</div>
					<div class="password-number">
						<input type="password" placeholder="密码" id="user-password"/>
					</div>
				</div>

				<div class="password-again form-group">
					<div class="xing">*</div>
					<div class="password-again-number">
						<input type="password" placeholder="再次输入密码" id="again-password"/>
					</div>
				</div>

				<div class="register-btn ">
					<div class="btn">注册</div>
				</div>

				<div class="register-bottom">
					<p class="bottom-one">点击注册，即表示你同意</p>
					<p class="bottom-two agreement">《马上理财用户协议》</p>
				</div>

			</div>

			<div class="register-suc">
				<div class="register-suc-bg1">
				<div class="suc-pic1">
					<img src="img/logo-mashanglc.png" alt="" />
				</div>
				<p class="suc-font-one suc-txt">恭喜你注册成功！</p>
				<p class="suc-font-two suc-txt1"><span id="wait_user">我</span>在</p>
				<p class="suc-txt1">马上理财等你！</p>
				<p class="suc-txt2">接下来</p>
				<p class="suc-txt3">下载并成功登录即可赢取</p>
				<p class="suc-txt3">现金奖励</p>
				<p class="suc-jt">
<img src="img/down.png"/>
</p>
				</div>
				<div class="register-suc-btn">
					<div class="suc-btn"><a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.mashanglc.android.licaiclient">下载领现金加息</a></div>
				</div>
			</div>

		</div>

		<script type="text/javascript" src="js/md5.js"></script>

		<script src="js/zepto.min.js" type="text/javascript"></script>
		<script>
		//是否微信内置浏览器
    function isWeixin() {
        var ua = navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            return true;
        } else {
            return false;
        }
    }

    //获取操作系统名称
    function getOS() {
        //定义结果变量
        var name = 'Other';
        var version = '';
        //获取userAgent
        var ua = navigator.userAgent;
        //移动平台iOS探测
        var reg = /like Mac OS X|Android|Windows Phone|Symbian/ig;
        var regResult = reg.exec(ua);
        if(!regResult){
            reg = /Mac OS X|Windows NT|Linux/ig;
            regResult = reg.exec(ua);
        }
        if(!regResult){
            //返回UNKNOWN
            return name;
        }else{
            //操作系统检测
            switch(regResult[0]){
                case 'like Mac OS X':
                    name = 'iPhone';
                    reg = /(iPhone|iPod|iPad).*?OS\s*(\d*[\_|\.\d]*)/ig;
                    break;
                case 'Android':
                    name = 'Android';
                    reg = /(Android)\s*(\d*[\.\d]*)/ig;
                    break;
                case 'Windows Phone':
                    name = 'Windows Phone';
                    reg = /(Windows Phone)\s*[OS]*\s*(\d*[\.\d]*)/ig;
                    break;
                case 'Symbian':
                    name = 'Symbian';
                    reg = /(Symbian)\s*[OS]*\/*\s*(\d[\.\d]*)/ig;
                    break;
                case 'Mac OS X':
                    name = 'OS X';
                    reg = /(Mac OS X)\s*(\d*[\_|\.\d]*)/ig;
                    break;
                case 'Windows NT':
                    name = 'Windows NT';
                    reg = /(Windows NT)\s*(\d*[\_|\.\d]*)/ig;
                    break;
                case 'Linux':
                    name = 'Linux';
                    reg = /(Linux)\s*(i*\d*)/ig;
                    break
            }
            //获取版本号
            regResult = reg.exec(ua);
            if(regResult && regResult.length >= 3){
                version = regResult[2].replace(/\_+/ig, '.');
                reg = /^\d+\.*\d*/ig;
                regResult = reg.exec(version);
                if(regResult){
                    version = regResult[0];
                }
            }
        };

        //返回操作系统名称+版本号
        //return [name, version].join(' ');
        return name.toLocaleLowerCase();
    };

/*获取url指定参数值*/
    function getUrlParameter(name){
        var url = location.search.substr(1);
        var value,arr1=[],arr2=[];

        if(url){
            arr1 = url.split("&");
            for(var i=0;i<arr1.length;i++){
                arr2=arr1[i].split("=");
                if(arr2[0]==name){
                    value = arr2[1];
                    if(value=="null" || value=="undefined"){
                        value = null;
                    }
                }
            }
        }
        return value;
    }

	function checkPhone(phone){
		var myreg = /^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
		if(!myreg.test(phone)) {
			return false;
		}
		return true;
	}
	function pwd(password){
		return hex_md5(password+"120141101");
	}

	/*根据hostname判断环境*/
    var publicApiHost,subDirectory, registerHost;

    if(location.hostname=="static.mashanglc.com"){
        publicApiHost = "http://api.mashanglc.com";
        registerHost = "http://static.mashanglc.com"
    }else if(location.hostname=="127.0.0.1" || location.hostname=="localhost" || location.hostname=="192.168.18.45"){
        publicApiHost = "http://192.168.18.45/api";
        registerHost = "http://static.sit.licai66.com"
    }else{
        subDirectory = location.hostname.split(".")[1];
        publicApiHost = "http://api."+subDirectory+".licai66.com";
        registerHost = "http://static."+subDirectory+".licai66.com"
    }

	var publicObj = {
        //isWeixin:isWeixin(),
        //phoneType:getOS(),
        domainname:"http://" + location.hostname,
        postUrl:publicApiHost + "/v2/api/web/register",
        verUrl:publicApiHost + "/v2/api/web/code",
		agreementUrl:publicApiHost + "/html/agreement.html",
        userType:1,
		appVer:"1.0",
		deviceType:"mobile_web",
		timestamp:new Date().getTime(),
        invitationCode:getUrlParameter("invitationCode"),
        fromUserType:getUrlParameter("userType")
    };

	var _r = publicObj.timestamp+"msfy_mslc_20160526_w"+publicObj.appVer+publicObj.deviceType+"web"+publicObj.appVer;
	publicObj.signature=hex_md5(_r);

	 Zepto(function($){
						
            if (!publicObj.fromUserType || publicObj.fromUserType != 2) {
                $(".top-right").css("display","none");
            }

            if (publicObj.invitationCode) {
                $(".invite-font").text("（邀请码）");
                $("#invite-number").val(publicObj.invitationCode);
                $("#invite-number").attr("readonly","readonly");
            }

			var _params = {
				userType:publicObj.userType,
				appVer:publicObj.appVer,
				deviceType:publicObj.deviceType,
				timestamp:publicObj.timestamp,
				signature:publicObj.signature,
				deviceId:"wap",
				osVer:getOS()
			}

			$(".content").on("click",".agreement",function(){
				window.location.href= publicObj.agreementUrl;
			});


			$(".content").on("click",".yanzheng-get",function(){
				var _phone = $("#user-number").val();
				if(!_phone || $.trim(_phone) == ''){
                    g_alert("手机号没有输入");
					return;
				}
				if(!checkPhone(_phone)){
                    g_alert("手机号码的格式不正确");
					return;
				}
				_params.phone = _phone;
				_params.reasonType = 1;

                g_loading();
				$.ajax({type:"POST",url:publicObj.verUrl,data:_params,dataType:'json',timeout:30000,
					success:function(data){
						remove_loading();

						var status = data.data.status;
						if(status == 0){
							g_alert("验证码已经发送");
						}else if(status == 100){
							g_alert("电话已经被注册");
						}else if(status == 110){
							g_alert("电话号码不存在");
						}else if(status == 200){
							g_alert("1分钟以内只能生成一次");
						}else {
							g_alert("获取验证码异常，请稍后尝试");
						}
					},
					error:function(){
						remove_loading();
						g_alert("网络错误，请稍后再试");
					}});
            });

			$(".content").on("click",".register-btn",function(){
				var _phone = $("#user-number").val();
			    var _user_yanzheng = $("#user-yanzheng").val();
				var _password = $("#user-password").val();
				var _again_password = $("#again-password").val();
				if(!_phone || $.trim(_phone) == ''){
					g_alert("手机号没有输入");
					return;
				}
				if(!checkPhone(_phone)){
					g_alert("手机号码的格式不正确");
					return;
				}
				if(!_user_yanzheng || $.trim(_user_yanzheng) == ''){
					g_alert("验证码不能为空");
					return;
				}
				if(!_password || $.trim(_password) == ''){
					g_alert("密码不能为空");
					return;
				}
				if(!_again_password || $.trim(_again_password) == ''){
					g_alert("再次输入密码不能为空");
					return;
				}
				if(_again_password!=_password){
					g_alert("两次输入的密码不一致");
					return;
				}
                if(_password.length < 6 || _password.length > 15) {
                    g_alert("密码长度应为6-15位");
                    return;
                }

				_params.phone = _phone;
				_params.password = pwd(_password);
				_params.code = _user_yanzheng;
                if (publicObj.invitationCode) {
                    _params.invitationCode = publicObj.invitationCode;
                } else {
                    if ($("#invite-number").val().length > 0) {
                        _params.invitationCode = $("#invite-number").val();
                    }
                }

                g_loading();
				$.ajax({type:"POST",url:publicObj.postUrl,data:_params,dataType:'json',timeout:30000,
					success:function(data){
						remove_loading();

						var _status = data.data.status;
						if(_status == 0){
							if(publicObj.fromUserType == '2'){
								$("#wait_user").text(data.data.msg);
							}else{
								$(".register-suc .suc-txt1").html("&nbsp;");
							}							
							$(".register").hide();
							$(".register-suc").show();
							$("body").addClass("register-suc-bg");
						}else {
							g_alert(data.data.msg);
						}
					},
					error:function(){
						remove_loading();
						g_alert("网络错误，请稍后再试");
					}});
            });
	 });

		</script>

	<script>
        /*公共ajax加载事件*/
        function g_loading(){

            if($('.g_loading').length<1){
                $("body").append("<div class='g_loading'></div>")
            }
        }

        function remove_loading(){
            $('.g_loading').remove();
            $('.g_alert').remove();
        }

		function g_alert(msg){
			var t;
			clearTimeout(t);
			if($('.g_alert').length<1){
				$("body").append('<div class="g_alert">'+msg+'</div>');
				var msg_w=$(".g_alert").width();
				var msg_h=$(".g_alert").height();
				$(".g_alert").css({"margin-left":-msg_w/2,"margin-top":-msg_h/2});
				t=setTimeout("$('.g_alert').remove()",2000);
			}
		}
	</script>

		<script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "//hm.baidu.com/hm.js?ca700516fc774085fe43ad4eced89f3b";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>

	</body>
</html>
